FIXED_PROMPT = "You are now working as an excellent expert in chemistry and molecule discovery.  You are called SynthesisGPT. Given the chemical reaction description and the extracted entity, you need to accurately describe each step of the reaction process using the notation of entity. \n\nThe chemical reactions have multiple steps. Do not use one line to describe the reaction. Change the line for each substep. Each substep is represented as \u2018[reactants] > [reaction conditions] > [products]\u2019. We call this format \u201cHeterogeneous Graph\u201d. The notations of entities are as follows:\n(1) Reactants include \u2018Rx\u2019 and \u2018Mx\u2019. \u2018Rx\u2019 represents reactants, \u2018Mx\u2019 represents the mixture \u2018x\u2019 with uncertain substances. \n(2) Reaction conditions include \u2018Sx\u2019, \u2018Cx\u2019, \u2018Ex\u2019, and \u2018Tx\u2019. \n(3) Products include symbols \u2018Mx\u2019 and \u2018Px\u2019. \n\nThe numbers after entities show their position(indices) in the reaction description, which only helps to identify the entities in the reaction description.\n\nAlso, you need to stick to 5 rules:\n(1) In each substep, [there are at most two \">\"], separating reactants, reaction conditions, and products! YOU MUST STRICTLY FOLLOW THIS FORMAT: Stuff before the first '>' is reactants \u201cRx\u201d; Stuff in between \"> >\" is reaction conditions \u2018Sx\u2019, \u2018Cx\u2019, \u2018Ex\u2019, and \u2018Tx\u2019; Stuff behind the second \">\" are products \u201cPx\u201d, \u201cMx\u201d. \n\n(2)A standard format is \u201cRx.Ry > Sx.Cx.Ex.Tx > Mx. If there is no reaction condition. There is no need to fill anything in between \u201c> >\u201d. Do not include Yields (Y1) into the reaction substeps because the reaction substeps always end with a \u201cP1\u201d. \n\n(3) Each reaction substep can have at most one occurrence of \u2018Ex\u2019 and \u2018Tx\u2019. x are integers representing the number of reactants, reaction conditions, and products. You CANNOT reuse the reaction conditions and reactants in different substeps!\n\n(4) The entities of reactants, reactant conditions (solvent, catalyst, time, temperature), and products are already listed after the total chemical reaction description. You need to extract the logic of chemical reactants to generate the Heterogeneous Graph correctly.\n\n(5) Do not include postprocessing procedures into substeps. Solvents (Sx), temperature conditions (Ex), and time conditions (Tx) associated with postprocessing procedures like filtration, crystallization, distilling, drying, extraction, washing with solvents, and purification should not be included in the heterogeneous graph.\n\nNow you may learn from the following examples about how the Heterogeneous Graph fits the reaction logic. Pay attention to the labels under training examples: \n\nTraining Example 1\n[Typical example of Multistep Reaction. You should identify the breakpoints between substeps]\n\n[Input]\nReaction 20141222-US08902305B2-0231 description:\nTo a N,N-dimethylformamide (10 mL) suspension of sodium hydride (97%, 0.784 g, 32.7 mmol) was added methyl 2-oxoindoline-5-carboxylate (2.34 g, 12.3 mmol). The formed mixture was stirred for 10 min at room temperature followed by the addition of 4-[(6-chloro-1-oxidopyridin-3-yl)methyl]morpholine (1.87 g, 8.2 mmol). The resulting reaction mixture was set under N2 atmosphere and stirred for 1 h at 135\u00b0 C. The N,N-dimethylformamide solution was diluted with saturated aqueous sodium hydrogen carbonate (30 mL) and extracted with chloroform, and ethyl acetate (containing 5% methanol). The combined organic phases were concentrated in vacuo. The remaining N,N-dimethylformamide was removed by co-evaporation with toluene. The residue was dissolved in ethyl acetate/chloroform, (150 mL, 2:1), and phosphorus trichloride (4.5 g, 33 mmol) was added. The reaction mixture was stirred for 1 h at 60\u00b0 C., and then cooled to room temperature. The mixture was poured into a saturated aqueous sodium hydrogen carbonate solution followed by extraction of the aqueous phase with chloroform (4\u00d7). The combined organic extracts were concentrated in vacuo, and the residue was purified on a silica gel column using chloroform/methanol, (10:1), as the eluent to afford 1.05 g (35% yield) of the title compound as a yellow-brown solid: 1H NMR (DMSO-d6, 400 MHz) \u03b4 10.83 (br s, 1H), 8.11 (s, 1H), 8.04 (s, 1H), 7.91 (d, J=8.0 Hz, 1H), 7.63 (t, J=8.0 Hz, 2H), 7.00 (d, J=8.0 Hz, 1H), 3.87 (s, 3H), 3.62 (br s, 4H), 3.41 (s, 2H), 2.42 (br s, 4H); MS (EI) m/z 368 (M++1).\n\nReactant:\nR1:sodium hydride,49;\nR2:methyl 2-oxoindoline-5-carboxylate,100;\nR3:4-[(6-chloro-1-oxidopyridin-3-yl)methyl]morpholine,246;\nR4:phosphorus trichloride,796;\n\nProduct:\nP1:title compound,1280;\n\nSolvent:\nS1:N,N-dimethylformamide,5;\nS2:N,N-dimethylformamide,411;\nS3:sodium hydrogen carbonate,477;\nS4:N,N-dimethylformamide,656;\nS5:sodium hydrogen carbonate,984;\n\nCatalyst:\nNone\n\nTime:\nT1:10 min,191;\nT2:1 h,392;\nT3:1 h,884;\n\nTemperature:\nE1:room temperature,201;\nE2:135\u00b0 C,399;\nE3:60\u00b0 C.,891;\nE4:room temperature,918;\n\nYield:\nY1:35% yield,1262;\n\n[Output]:\nR1.R2>S1.E1.T1>M1\nM1.R3>E2.T2>M2\nM2.R4>E3.T3>P1\n\nTraining Example 2\n[Many post-process reaction procedures should be excluded from the heterogeneous graph.]\n\n[Input]\nReaction 20120214-US08114886B2-0551 description:\n5-[[(4-Chloro-3-methylphenyl)sulfonyl](2,5-difluorophenyl) methyl]-4-methylpyridine-2-carboxylic acid (300 mg, 0.66 mmol), 2-aminoethanol (60 \u03bcl, 0.99 mmol), 1-ethyl-3-(3-dimethylaminopropyl)carbodiimide hydrochloride (191 mg, 0.99 mmol), 1-hydroxybenzotriazole (89 mg, 0.66 mmol), and triethylamine (275 \u03bcl, 1.98 mmol) were dissolved in methylene chloride (60 ml), and the resulting mixture was stirred overnight at room temperature. Water was added to the reaction mixture, and the mixture was extracted twice with methylene chloride. The combined organic layer was dried over anhydrous sodium sulfate and filtered, and then the filtrate was concentrated under reduced pressure. The resulting residue was purified by preparative thin-layer chromatography (developed with 5% methanol/methylene chloride, eluted with 30% methanol/methylene chloride), to obtain the title compound (190 mg, 0.38 mmol, 58%) as a white amorphous substance.\n\nREACTANTs:\nR1,5-[[(4-Chloro-3-methylphenyl)sulfonyl](2,5-difluorophenyl) methyl]-4-methylpyridine-2-carboxylic acid,0;\nR2,1-ethyl-3-(3-dimethylaminopropyl)carbodiimide hydrochloride,158;\nR3,1-hydroxybenzotriazole,239;\nR4,2-aminoethanol,123;\nR5,triethylamine,286;\n\n\nPRODUCTs:\nP1,title compound,865;\n\n\nSOLVENTs:\nS1,methylene chloride,338;\nS2,methylene chloride,517;\nS3,methylene chloride,785;\nS4,methylene chloride,830;\nS5,Water,435;\n\n\nCATALYSTs:\nNone\n\nTIMEs:\nT1,overnight,404;\n\n\nTEMPERATUREs:\nE1,room temperature,417;\n\n\nYIELD:\nY1,58%,900;\n\n[Output]\nR1.R2.R3.R4.R5>S1.E1.T1>P1\n\n\nTraining Example 3\n[Typical example with the catalyst in the reaction condition]\n\n[Input]\nReaction 20160225-US20160056388A1-0282 description:\nThen, under an argon stream, 2-[3-chloro-5-(9-phenanthryl)phenyl]-4,6-diphenyl-1,3,5-triazine (5.20 g, 10.0 mmol), 4,4,4\u2032,4\u2032,5,5,5\u2032,5\u2032-octamethyl-2,2\u2032-bi-1,3,2-dioxaborolane (3.81 g, 15.0 mmol), palladium acetate (22.5 mg, 0.10 mmol), 2-dicyclohexylphosphino-2\u2032,4\u2032,6\u2032-triisopropyl biphenyl (95.4 mg, 0.20 mmol) and potassium acetate (2.95 g, 30 mmol), were suspended in 1,4-dioxane (200 mL), and the mixture was stirred for 4 hours at 100\u00b0 C. After cooling, the precipitate was removed by filtration using a filter paper. Further, liquid separation was conducted with chloroform, and the organic layer was concentrated to obtain a crude solid. Hexane was added to the crude solid, followed by cooling to ice temperature, and then, the solid was separated by filtration, followed by drying under vacuum to obtain a white solid of 4,6-diphenyl-2-[5-(9-phenanthryl)-3-(4,4,5,5-tetramethyl-1,3,2-dioxaborolan-2-yl)phenyl]-1,3,5-triazine as an intermediate (amount: 6.07 g, yield: 99%).\n\nREACTANTs:\nR1: 2-[3-chloro-5-(9-phenanthryl)phenyl]-4,6-diphenyl-1,3,5-triazine,29;\nR2: 4,4,4\u2032,4\u2032,5,5,5\u2032,5\u2032-octamethyl-2,2\u2032-bi-1,3,2-dioxaborolane,115;\nR3: 2-dicyclohexylphosphino-2\u2032,4\u2032,6\u2032-triisopropyl biphenyl,235;\nR4: potassium acetate,315;\n\nPRODUCTs:\nP1: 4,6-diphenyl-2-[5-(9-phenanthryl)-3-(4,4,5,5-tetramethyl-1,3,2-dioxaborolan-2-yl)phenyl]-1,3,5-triazine,829;\n\nSOLVENTs:\nS1: 1,4-dioxane,370;\nS2: Hexane,644;\n\nCATALYSTs:\nC1: palladium acetate,195;\n\nTIMEs:\nT1: 4 hours,424;\n\nTEMPERATUREs:\nE1: 100\u00b0 C,435;\n\nYIELD:\nY1: yield: 99%,969;\n\n[Output]\nR1.R2.R3.R4>C1.S1.E1.T1>M1\nM1>S2>P1\n\nTraining Example 4\n[Typical example of single-step reaction]\n\n[Input]\nReaction 20100427-US07705028B2-0287 description:\nA solution of [3-[2-(2,6-dichlorophenyl)ethyl]-5-(1-methylethyl)-4-isoxazolyl]methanol (0.085 g, 0.27 mmol), methyl 6-(4-hydroxyphenyl)-2-naphthalenecarboxylate (0.075 g, 0.27 mmol), triphenyl phosphine (0.071 g, 0.27 mmol) and diisopropyl azodicarboxylate (0.049 mL, 0.27 mmol) in toluene (2.7 mL) was placed in microwave reaction tube and heated to 80\u00b0 C. for 1000 seconds. The solution was concentrated and the residue dissolved in a solution of ethyl acetate and methanol, filtered and concentrated. The filtrate was purified by chromatography (silica gel, hexane to 3:7 ethyl acetate:hexanes) to provide the title compound (0.038 g, 24.5%). 1H NMR (DMSO-d6): \u03b4 8.62 (s, 1H), 8.25 (s, 1H), 8.18 (d, J=9 Hz, 1H), 8.06 (d, J=9 Hz, 1H), 7.97 (dd, J=1, 9 Hz, 1H), 7.92 (dd, J=2, 9 Hz, 1H), 7.81 (d, J=9 Hz, 2H), 7.42 (d, J=8 Hz, 2H), 7.25 (t, J=8 Hz, 1H), 7.14 (d, J=9 Hz, 2H), 4.99 (s, 2H), 3.90 (s, 3H), 3.35 (septet, J=7 Hz, overlapping H2O 1H), 3.24-3.20 (m, 2H), 2.89-2.85 (m, 2H), 1.25 (d, J=7 Hz, 6H). ESI-LCMS m/z 574 (M+H)+.\n\nREACTANTs:\nR1: [3-[2-(2,6-dichlorophenyl)ethyl]-5-(1-methylethyl)-4-isoxazolyl]methanol,14;\nR2: methyl 6-(4-hydroxyphenyl)-2-naphthalenecarboxylate,109;\nR3: diisopropyl azodicarboxylate,228;\nR4: triphenyl phosphine,183;\n\n\nPRODUCTs:\nP1: title compound,613;\n\n\nSOLVENTs:\nS1: toluene,282;\n\nCATALYSTs:\nNone\n\nTIMEs:\nT1: 1000 seconds,362;\n\n\nTEMPERATUREs:\nE1: 80\u00b0 C.,351;\n\n\nYIELD:\n24.5%,638;\n\n[Output]\nR1.R2.R3.R4>S1.E1.T1>P1\n\nNow that you have learned the mechanism, please turn the reactions below into Heterogeneous Graphs only with no introduction, no explanation. DON'T MAKE ANY MISTAKES, check if you did any."

null = None

test_output ={"model": "gpt-3.5-turbo", "messages": [{"role": "system", "content": "You are now working as an excellent expert in chemistry and molecule discovery."}, {"role": "user", "content": "Given a chemical reaction description, the extracted entities with their position in the description, please output entities which are related to the chemical reaction process, and IGNORE which belong to the work-up phase after the reaction completion.\nOutput with no introduction, no explanation, only entities. DON'T MAKE ANY MISTAKES, check if you did any.\n\n***\nExample:\n{\nReaction 19950110-US05380742-0009 description:\nA solution of 61.64 g (282 mmol) of di(1,1-dimethylethyl) dicarbonate in 275 ml of dioxane followed by 274 ml of a 2M sodium hydroxide solution are added dropwise, at 0\u00b0 C., to a suspension of 50 g (182 mmol) of 1,3-dichloro-5,6-dihydro-4H-thieno[3,4-c ]pyrrole hydrobromide in 500 ml of dioxane. After stirring for 1 hour at room temperature, the precipitate is filtered off, rinsed with twice 500 ml of water and dried at 70\u00b0 C overnight. 51 g of a 1,3-Dichloro-5-(1,1-dimethylethoxy)carbonyl-5,6-dihydro-4H-thieno[3,4-c]pyrrole are obtained. Yield 95%. Melting point: 112\u00b0-114\u00b0 C.\n\nREACTANTs:\n1,3-dichloro-5,6-dihydro-4H-thieno[3,4-c ]pyrrole hydrobromide,212;\ndi(1,1-dimethylethyl) dicarbonate,36;\nsodium hydroxide,118;\n\nPRODUCTs:\n1,3-Dichloro-5-(1,1-dimethylethoxy)carbonyl-5,6-dihydro-4H-thieno[3,4-c]pyrrole,451;\n\nSOLVENTs:\ndioxane,83;\ndioxane,288;\nwater,405;\n\nCATALYSTs:\nNone\n\nTIMEs:\n1 hour,316;\novernight,430;\n\nTEMPERATUREs:\n0\u00b0 C.,167;\n0\u00b0 C.,425;\nroom temperature,326;\n70\u00b0 C,424;\n112\u00b0-114\u00b0 C.,571;\n\nYIELD:\nYield 95%,545;\n\n}\n\nOutput:\n\"\"\"\nReaction 19950110-US05380742-0009 description:\nREACTANTs:\n1,3-dichloro-5,6-dihydro-4H-thieno[3,4-c ]pyrrole hydrobromide,212;\ndi(1,1-dimethylethyl) dicarbonate,36;\nsodium hydroxide,118;\n\nPRODUCTs:\n1,3-Dichloro-5-(1,1-dimethylethoxy)carbonyl-5,6-dihydro-4H-thieno[3,4-c]pyrrole,451;\n\nSOLVENTs:\ndioxane,83;\ndioxane,288;\n\nCATALYSTs:\nNone\n\nTIMEs:\n1 hour,316;\n\nTEMPERATUREs:\nroom temperature,326;\n\nYIELD:\nYield 95%,545;\n\n\"\"\"\n***\n\n{\nReaction 20040708-US20040132720A1-0125 description:\nFinely powdered D3 (9.7 g, 34 mmole) under argon was heated with gentle stirring up to its melting point (>250\u00b0 C.) at which point the dark brown oil was observed to undergo decarboxylation. Heating was maintained until gas evolution ceased (0.25 h), then the mixture was allowed to cool. The residue was treated with 1M NaOH solution (120 ml) and Et2O (100 ml) and stirred well for 0.5 h. The aqueous layer was isolated, filtered, then acidified with conc. HCl acid and extracted with EtOAc. The extract was dried (Na2SO4) and concentrated under vacuum to afford the title compound as a pale yellow solid (5.9 g, 72%).\n\nREACTANTs:\nNaOH,321;\nD3,16;\n\n\nPRODUCTs:\ntitle compound,568;\n\n\nSOLVENTs:\nEt2O,348;\n\n\nCATALYSTs:\nNone\n\nTIMEs:\n0.25 h,242;\n0.5 h,383;\n\n\nTEMPERATUREs:\n>250\u00b0 C.,106;\n\n\nYIELD:\n72%,614;\n\n}\n\n{\nReaction 19980127-US05712403-0001 description:\nIn a 300 ml eggplant-type flask equipped with a Dimroth condenser, 10.4 g (0.068 mol) of intermediate 6-(hydroxymethyl)-2,4-dimethylphenol and 11.6 g (0.071 mol) of 2-t-butyl-4-methylphenol were suspended in 50 ml of water. To this suspension, an aqueous solution having 10.3 g (0.26 mol) of sodium hydroxide dissolved in 50 ml of water, was added, and the mixture was stirred by a magnetic stirrer. This mixture was heated to 100\u00b0 C. and stirred at that temperature for 12 hours. The reaction mixture was cooled to room temperature, then acidified by concentrated hydrochloric acid and extracted with toluene. The obtained toluene solution was washed with water and then dried over anhydrous magnesium sulfate. From the solution having the anhydrous magnesium sulfate removed, toluene was distilled off, and the obtained residue was separated by silica gel chromatography to obtain 10.6 g (0.036 mol, yield: 51.9%) of (2-hydroxy-3-t-butyl-5-methylphenyl)-(2-hydroxy-3,5-dimethylphenyl)methane as a brown highly viscous liquid. By 1HNMR, the liquid was confirmed to be the desired product.\n\nREACTANTs:\n6-(hydroxymethyl)-2,4-dimethylphenol,102;\n2-t-butyl-4-methylphenol,165;\nhydrochloric acid,565;\nsodium hydroxide,292;\nintermediate,89;\n\n\nPRODUCTs:\n(2-hydroxy-3-t-butyl-5-methylphenyl)-(2-hydroxy-3,5-dimethylphenyl)methane,919;\n\n\nSOLVENTs:\nwater,217;\nwater,331;\nwater,657;\n\n\nCATALYSTs:\nNone\n\nTIMEs:\n12 hours,471;\n\n\nTEMPERATUREs:\n100\u00b0 C.,427;\nroom temperature,516;\n\n\nYIELD:\nyield: 51.9%,902;\n\n}\n\n{\nReaction 20141202-US08901305B2-0220 description:\n(S)-tert-butyl (4-methyl-1-((5-oxo-5,6-dihydrobenzo[c][2,7]naphthyridin-8-yl)oxy)pentan-2-yl)carbamate (10 mg, 0.024 mmol) in dichloromethane (1 mL) was cooled to 0\u00b0 C. To the solution was added hydrogen chloride (0.886 mg, 0.012 mL, 0.024 mmol, 2M in diethyl ether) dropwise. The temperature of the reaction mixture was maintained at 0\u00b0 C. for 30 min and then the reaction mixture was allowed to warm to room temperature and stirred for 2 h. The reaction mixture was then concentrated under reduced pressure to afford (S)-8-((2-amino-4-methylpentyl)oxy)benzo[c][2,7]naphthyridin-5(6H)-one (4 mg, 0.012 mmol, 49% yield) as a pale yellow solid. LC/MS (ESI) m/e 312.2 [(M+H)+, calcd for C18H22N3O2 312.2]; LC/MS retention time (method A): tR=1.1 min; HPLC retention time (method A): tR=6.85 min; HPLC retention time (method B): tR=7.51 min 1H NMR (400 MHz, D2O) \u03b4 ppm 9.30 (br. s., 1H), 8.77 (br. s., 1H), 8.36 (br. s., 1H), 8.07 (br. s., 1H), 6.95 (br. s., 1H), 6.72 (br. s., 1H), 4.41 (d, J=9.03 Hz, 1H), 4.26 (br. s., 1H), 3.89 (br. s., 1H), 3.38 (s, 1H), 1.72-1.88 (m, 2H), 1.05 (d, J=2.51 Hz, 6H).\n\nREACTANTs:\n(S)-tert-butyl (4-methyl-1-((5-oxo-5,6-dihydrobenzo[c][2,7]naphthyridin-8-yl)oxy)pentan-2-yl)carbamate,0;\nhydrogen chloride,195;\n\n\nPRODUCTs:\n(S)-8-((2-amino-4-methylpentyl)oxy)benzo[c][2,7]naphthyridin-5(6H)-one,519;\n\n\nSOLVENTs:\ndichloromethane,126;\n\n\nCATALYSTs:\nNone\n\nTIMEs:\n30 min,345;\n2 h,438;\n\n\nTEMPERATUREs:\n0\u00b0 C,163;\n0\u00b0 C,335;\n0\u00b0 C.,163;\n0\u00b0 C.,335;\nroom temperature,405;\n\n\nYIELD:\n49% yield,609;\n\n}\n\nOutput:\n\"\"\"Entities\"\"\"\n"}], "temperature": 0.2, "n": 3}

if __name__=='__main__':
    import json
    request_path = '/Users/gongshukai/Desktop/ML RESEARCH/Ongoing Project/USPTO dataset/Larrea/requests/uspto_requests.json'
    request_list = []
    with open(request_path, 'r') as f:
        requests = f.__iter__()
        while True:
            try:
                request_json = json.loads(next(requests))
                request_list.append(request_json)
            except StopIteration:
                print("finish extraction.")
                break
    
    for request in request_list:
        try:
            # print(FIXED_PROMPT)
            print(request[0]["messages"][1]["content"])
            print(request[1]["choices"][0]["message"]["content"])
        except:
            print(request["messages"][1]["content"])
        
        input('Please enter.')
    
    